<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Exsaver RTU v3.5 (No-Popup & Entry Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 7ì¸ì¹˜ ìŠ¤í¬ë¦° ê·œê²© ê³ ì • */
        body { width: 1024px; height: 600px; overflow: hidden; background-color: #020617; }
        .blueprint-container { position: relative; width: 900px; height: 450px; background-size: 100% 100%; margin: 0 auto; border: 1px solid #1e293b; background-color: #000; }
        
        /* í™”ë©´ ì „í™˜ ì•ˆì •í™”ìš© í´ë˜ìŠ¤ */
        .page-active { display: flex !important; visibility: visible !important; opacity: 1 !important; }
        .hidden { display: none !important; }

        .group-layer { position: absolute; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; border: 2px solid transparent; }
        .group-layer.status-off { background: rgba(239, 68, 68, 0.15); border-color: rgba(239, 68, 68, 0.3); }
        .group-layer.status-on { background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.4); }
        
        .scroll-container { height: 480px; overflow-y: auto; }
        .keypad-btn { background: #1e293b; height: 65px; font-size: 24px; border-radius: 12px; border: 1px solid #334155; width: 100%; }
        .modal-overlay { background: rgba(0,0,0,0.95); backdrop-filter: blur(8px); position: fixed; inset: 0; z-index: 1000; }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans text-sm">

    <div id="page-user" class="page-active flex flex-col h-full">
        <header class="p-3 flex justify-between items-center bg-slate-900 border-b border-slate-800">
            <h1 class="text-lg font-black text-blue-500 italic">RTU MONITOR</h1>
            <div class="flex items-center gap-5">
                <div id="top-clock" class="font-mono text-slate-400">00:00:00</div>
                <button onclick="showLogin()" class="px-4 py-1.5 bg-blue-600 rounded-lg font-bold text-xs shadow-lg active:scale-95 transition">
                    ğŸ”’ ADMIN LOGIN
                </button>
            </div>
        </header>

        <main class="flex-1 flex flex-col justify-center relative p-4">
            <div id="blueprint" class="blueprint-container shadow-2xl"></div>
            <button class="absolute left-4 p-5 bg-slate-800/40 rounded-full hover:bg-blue-600" onclick="changePage(-1)">â†</button>
            <button class="absolute right-4 p-5 bg-slate-800/40 rounded-full hover:bg-blue-600" onclick="changePage(1)">â†’</button>
        </main>
    </div>

    <div id="page-admin-main" class="hidden flex-col h-full bg-slate-950 w-full">
        <nav class="p-3 bg-slate-900 border-b border-slate-800 flex justify-between items-center shadow-md">
            <div class="flex gap-2 bg-slate-800 p-1 rounded-xl">
                <button id="tab-individual" onclick="switchAdminTab('individual')" class="px-5 py-2 bg-blue-600 rounded-lg font-bold text-xs transition">ê°œì¸ë³„</button>
                <button id="tab-group" onclick="switchAdminTab('group')" class="px-5 py-2 rounded-lg text-slate-400 text-xs transition">ê·¸ë£¹ë³„</button>
                <button id="tab-floor" onclick="switchAdminTab('floor')" class="px-5 py-2 rounded-lg text-slate-400 text-xs transition">ì¸µë³„</button>
            </div>
            <div class="flex gap-3">
                <button onclick="location.reload()" class="px-5 py-2 bg-slate-800 rounded-lg text-xs font-bold hover:bg-red-900/50">LOGOUT</button>
            </div>
        </nav>
        
        <div class="scroll-container p-4">
            <table class="w-full text-center border-separate border-spacing-y-2">
                <thead id="admin-table-head" class="sticky top-0 bg-slate-950 z-10 text-[10px] text-slate-500 uppercase">
                    <tr><th>ì¥ë¹„ ëª…ì¹­</th><th>ì ˆê°ëŸ‰(kW)</th><th>ëˆ„ì ëŸ‰(kWh)</th><th>ìˆœì‹œì „ë ¥(kW)</th><th>ìƒíƒœ</th></tr>
                </thead>
                <tbody id="admin-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="page-login" class="hidden modal-overlay flex items-center justify-center">
        <div class="bg-slate-900 p-8 rounded-3xl border border-slate-700 w-[320px] text-center shadow-2xl">
            <h2 class="text-sm font-bold mb-6 text-blue-400 uppercase tracking-widest">ê´€ë¦¬ì ì¸ì¦</h2>
            <div id="pin-display" class="bg-black p-4 mb-6 rounded-2xl text-4xl h-16 flex items-center justify-center font-mono tracking-[0.3em] border border-slate-800"></div>
            <div class="grid grid-cols-3 gap-2">
                <script>for(let i=1; i<=9; i++) document.write(`<button onclick="pressKey('${i}')" class="keypad-btn active:bg-blue-600">${i}</button>`);</script>
                <button onclick="clearPin()" class="keypad-btn text-red-500 font-bold">C</button>
                <button onclick="pressKey('0')" class="keypad-btn">0</button>
                <button onclick="hideLogin()" class="keypad-btn text-slate-500 text-xs font-bold uppercase tracking-tighter">Back</button>
            </div>
        </div>
    </div>

    <script>
        let layoutData = JSON.parse(localStorage.getItem('rtu_group_layout')) || {
            1: [ {t:20, l:15, w:250, h:150, name: "1ì¸µ ì‚¬ë¬´êµ¬ì—­", lcuIds: [1,2,3], status: 'OFF'} ],
            2: [ {t:30, l:30, w:250, h:150, name: "2ì¸µ ì—°êµ¬ì‹¤", lcuIds: [6,7,8], status: 'OFF'} ],
            3: [ {t:50, l:40, w:200, h:120, name: "3ì¸µ ì„ì›ì‹¤", lcuIds: [11], status: 'OFF'} ]
        };

        let curPage = 1, pin = "";

        // PIN ì…ë ¥ ë¡œì§
        function pressKey(num) {
            if(pin.length < 4) {
                pin += num;
                document.getElementById('pin-display').innerText = 'â—'.repeat(pin.length);
            }
            if(pin.length === 4) {
                if(pin === "0000") {
                    enterAdminMode(); // ì„±ê³µ ì‹œ ì¦‰ì‹œ ì´ë™
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                    clearPin();
                }
            }
        }

        function clearPin() { pin = ""; document.getElementById('pin-display').innerText = ""; }

        // [íŒ¨ì¹˜] ê´€ë¦¬ì ëª¨ë“œ ì§„ì… (íŒì—… ì œê±° ë° ê²€ì€ í™”ë©´ ë°©ì§€)
        function enterAdminMode() {
            // 1. ë¡œê·¸ì¸ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
            document.getElementById('page-login').classList.add('hidden');
            // 2. ì‚¬ìš©ì ëª¨ë“œ ìˆ¨ê¸°ê¸°
            document.getElementById('page-user').classList.add('hidden');
            document.getElementById('page-user').classList.remove('page-active');
            
            // 3. ê´€ë¦¬ì ë©”ì¸ í™œì„±í™” (í´ë˜ìŠ¤ ê°•ì œ ë¶€ì—¬)
            const adminMain = document.getElementById('page-admin-main');
            adminMain.classList.remove('hidden');
            adminMain.classList.add('page-active');
            
            // 4. ë°ì´í„° í…Œì´ë¸” ì´ˆê¸° ë Œë”ë§
            renderAdminTable();
        }

        function showLogin() {
            clearPin();
            document.getElementById('page-login').classList.remove('hidden');
        }

        function hideLogin() {
            document.getElementById('page-login').classList.add('hidden');
        }

        // ë„ë©´ ë° ë ˆì´ì–´ ë Œë”ë§
        function updatePage() {
            const container = document.getElementById('blueprint');
            container.style.backgroundImage = `url('rtu_ui${curPage === 1 ? '' : curPage}.jpg')`;
            renderGroupLayers();
        }

        function renderGroupLayers() {
            const container = document.getElementById('blueprint');
            container.innerHTML = '';
            const groups = layoutData[curPage] || [];

            groups.forEach((group) => {
                const layer = document.createElement('div');
                layer.className = `group-layer ${group.status === 'ON' ? 'status-on' : 'status-off'}`;
                layer.style.cssText = `top:${group.t}%; left:${group.l}%; width:${group.w}px; height:${group.h}px;`;
                layer.innerHTML = `<div class="bg-black/70 px-3 py-1 rounded-lg text-xs font-bold border border-white/20">${group.name}</div>`;
                
                layer.onclick = () => {
                    if(group.status === 'OFF') {
                        if(confirm(`[${group.name}] êµ¬ì—­ì˜ ì „ì›ì„ ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            group.status = 'ON';
                            localStorage.setItem('rtu_group_layout', JSON.stringify(layoutData));
                            renderGroupLayers();
                        }
                    }
                };
                container.appendChild(layer);
            });
        }

        function renderAdminTable() {
            const body = document.getElementById('admin-table-body');
            body.innerHTML = '';
            // ì‹œë®¬ë ˆì´ì…˜ìš© ë°ì´í„° ìƒì„±
            for(let i=1; i<=10; i++) {
                const tr = document.createElement('tr');
                tr.className = "bg-slate-900 border border-slate-800 hover:bg-slate-800 transition";
                tr.innerHTML = `
                    <td class="p-4 font-bold text-blue-400">LCU-Device-${i.toString().padStart(2,'0')}</td>
                    <td class="font-mono text-xs text-slate-300">2.${i}</td>
                    <td class="font-mono text-xs text-slate-300">14${i}.5</td>
                    <td class="font-mono text-xs text-green-400">0.4${i}</td>
                    <td><span class="px-3 py-1 bg-green-900/50 text-green-400 rounded-full text-[10px] font-bold border border-green-700/50">ON</span></td>
                `;
                body.appendChild(tr);
            }
        }

        function changePage(d) {
            curPage = Math.max(1, Math.min(3, curPage + d));
            updatePage();
        }

        setInterval(() => {
            document.getElementById('top-clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        window.onload = updatePage;
    </script>
</body>
</html>
