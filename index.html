<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Exsaver RTU v3.4 (Admin Entry Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { width: 1024px; height: 600px; overflow: hidden; background-color: #020617; }
        .blueprint-container { position: relative; width: 900px; height: 450px; background-size: 100% 100%; margin: 0 auto; border: 1px solid #1e293b; }
        .group-layer { position: absolute; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; border: 2px solid transparent; }
        .group-layer.status-off { background: rgba(239, 68, 68, 0.15); border-color: rgba(239, 68, 68, 0.3); }
        .group-layer.status-on { background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.4); }
        .edit-mode .group-layer { border: 2px dashed #3b82f6; background: rgba(59, 130, 246, 0.2); }
        .keypad-btn { background: #1e293b; height: 65px; font-size: 24px; border-radius: 12px; border: 1px solid #334155; width: 100%; }
        .modal-overlay { background: rgba(0,0,0,0.9); backdrop-filter: blur(4px); position: fixed; inset: 0; z-index: 500; }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans text-sm">

    <div id="page-user" class="flex flex-col h-full">
        <header class="p-3 flex justify-between items-center bg-slate-900 border-b border-slate-800">
            <h1 class="text-lg font-black text-blue-500 italic">RTU MONITOR</h1>
            <div class="flex items-center gap-5">
                <div id="top-clock" class="font-mono text-slate-400">00:00:00</div>
                <button onclick="showLogin()" class="px-4 py-1.5 bg-blue-600 rounded-lg font-bold text-xs shadow-lg active:scale-95 transition">
                    ğŸ”’ ADMIN LOGIN
                </button>
            </div>
        </header>

        <main class="flex-1 flex flex-col justify-center relative p-4">
            <div id="blueprint" class="blueprint-container shadow-2xl"></div>
            <button class="absolute left-4 p-5 bg-slate-800/40 rounded-full" onclick="changePage(-1)">â†</button>
            <button class="absolute right-4 p-5 bg-slate-800/40 rounded-full" onclick="changePage(1)">â†’</button>
        </main>
    </div>

    <div id="page-login" class="hidden modal-overlay flex items-center justify-center">
        <div class="bg-slate-900 p-8 rounded-3xl border border-slate-700 w-[320px] text-center shadow-2xl">
            <h2 class="text-sm font-bold mb-6 text-blue-400 uppercase tracking-widest">ê´€ë¦¬ì ì¸ì¦</h2>
            <div id="pin-display" class="bg-black p-4 mb-6 rounded-2xl text-4xl h-16 flex items-center justify-center font-mono tracking-[0.3em] border border-slate-800"></div>
            <div class="grid grid-cols-3 gap-2">
                <script>for(let i=1; i<=9; i++) document.write(`<button onclick="pressKey('${i}')" class="keypad-btn active:bg-blue-600">${i}</button>`);</script>
                <button onclick="clearPin()" class="keypad-btn text-red-500 font-bold">C</button>
                <button onclick="pressKey('0')" class="keypad-btn">0</button>
                <button onclick="hideLogin()" class="keypad-btn text-slate-500 text-sm font-bold uppercase">Back</button>
            </div>
        </div>
    </div>

    <script>
        let layoutData = JSON.parse(localStorage.getItem('rtu_group_layout')) || {
            1: [ {t:20, l:15, w:250, h:150, name: "1ì¸µ ì‚¬ë¬´êµ¬ì—­", lcuIds: [1,2,3], status: 'OFF'} ],
            2: [ {t:30, l:30, w:250, h:150, name: "2ì¸µ ì—°êµ¬ë™", lcuIds: [6,7], status: 'OFF'} ],
            3: [ {t:50, l:40, w:200, h:120, name: "3ì¸µ íšŒì˜ì‹¤", lcuIds: [11], status: 'OFF'} ]
        };

        let curPage = 1, pin = "", isEditMode = false;

        // --- ë¡œê·¸ì¸ ì§„ì… ì œì–´ (ì´ ë¶€ë¶„ì´ ë²„ê·¸ í•´ê²°ì˜ í•µì‹¬) ---
        function showLogin() {
            pin = ""; // ì´ˆê¸°í™”
            document.getElementById('pin-display').innerText = "";
            document.getElementById('page-login').classList.remove('hidden');
            // ì‚¬ìš©ì ëª¨ë“œ ë°°ê²½ì„ ìœ ì§€í•˜ê±°ë‚˜ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì—¬ê¸°ì„œëŠ” ëª¨ë‹¬ë¡œ ë„ì›€)
        }

        function hideLogin() {
            document.getElementById('page-login').classList.add('hidden');
        }

        function pressKey(num) {
            if(pin.length < 4) {
                pin += num;
                document.getElementById('pin-display').innerText = 'â—'.repeat(pin.length);
            }
            if(pin.length === 4) {
                if(pin === "0000") { // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                    enterAdminMode();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                    clearPin();
                }
            }
        }

        function clearPin() {
            pin = "";
            document.getElementById('pin-display').innerText = "";
        }

        function enterAdminMode() {
            document.getElementById('page-login').classList.add('hidden');
            document.getElementById('page-user').classList.add('hidden');
            // ì—¬ê¸°ì— ê´€ë¦¬ì ë©”ì¸ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ë¡œì§ ì¶”ê°€
            alert("ê´€ë¦¬ì ëª¨ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.");
            // location.href = 'admin_main.html'; // ì‹¤ì œ êµ¬í˜„ì‹œ í˜ì´ì§€ ì´ë™ ë˜ëŠ” ì•„ë˜ì²˜ëŸ¼ ì²˜ë¦¬
            // document.getElementById('page-admin-main').classList.remove('hidden');
        }

        // --- ë„ë©´ ë° ê·¸ë£¹ ë Œë”ë§ ---
        function updatePage() {
            const container = document.getElementById('blueprint');
            container.style.backgroundImage = `url('rtu_ui${curPage === 1 ? '' : curPage}.jpg')`;
            renderGroupLayers();
        }

        function renderGroupLayers() {
            const container = document.getElementById('blueprint');
            container.innerHTML = '';
            const groups = layoutData[curPage] || [];

            groups.forEach((group, idx) => {
                const layer = document.createElement('div');
                layer.className = `group-layer ${group.status === 'ON' ? 'status-on' : 'status-off'}`;
                layer.style.cssText = `top:${group.t}%; left:${group.l}%; width:${group.w}px; height:${group.h}px;`;
                
                layer.innerHTML = `<div class="bg-black/60 px-2 py-1 rounded text-xs font-bold">${group.name}</div>`;
                
                layer.onclick = () => {
                    if(group.status === 'OFF') {
                        if(confirm(`[${group.name}] êµ¬ì—­ì„ ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            group.status = 'ON';
                            save(); renderGroupLayers();
                        }
                    }
                };
                container.appendChild(layer);
            });
        }

        function save() { localStorage.setItem('rtu_group_layout', JSON.stringify(layoutData)); }
        function changePage(d) { curPage = Math.max(1, Math.min(3, curPage + d)); updatePage(); }
        
        setInterval(() => {
            const clock = document.getElementById('top-clock');
            if(clock) clock.innerText = new Date().toLocaleTimeString();
        }, 1000);

        window.onload = updatePage;
    </script>
</body>
</html>
